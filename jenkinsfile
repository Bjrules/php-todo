pipeline{
    agent any

    environment {
        IMAGE_TAG = "${env.BUILD_NUMBER}"
     // DOCKER_CREDENTIALS_ID = 'Dockerhub-login' // ID of Jenkins credentials (Username + Password)
    }
    // In java make sure you define the maven as the compile tool
    stages{
        stage("Git Checkout"){
            steps{
                git branch: 'project20-jenkins-Docker', credentialsId: 'Github', url: 'https://github.com/Bjrules/php-todo.git'
            }
        }

          stage('Build Image') {
            steps {
                script {

                    withDockerRegistry(credentialsId: 'docker-login') {
                        sh "docker build -t bjrules/phptodo:$IMAGE_TAG ."
 
                    }
                  
                }
            }
        }


          stage('Push Image') {
            steps {
                script {

                    withDockerRegistry(credentialsId: 'docker-login') {
                        sh "docker push bjrules/phptodo:$IMAGE_TAG"
 
                    }
                  
                }
            }
        }
    }
        
 }

