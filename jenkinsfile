pipeline{
    agent any

    environment {
         //DOCKER_REGISTRY = 'index.docker.io'  // e.g., index.docker.io or your private registry
        //DOCKER_IMAGE = "${DOCKER_REGISTRY}/bjrules/php-app"
        IMAGE_TAG = "$v{BUILD_NUMBER}"
        DOCKER_CREDENTIALS_ID = 'Dockerhub-login' // ID of Jenkins credentials (Username + Password)
    }
    // In java make sure you define the maven as the compile tool
    stages{
        stage("Git Checkout"){
            steps{
                git branch: 'project20-jenkins-Docker', credentialsId: 'Github', url: 'https://github.com/Bjrules/php-todo.git'
            }
        }

          stage('Build Image') {
            steps {
                script {

                    withDockerRegistry(credentialsId: 'docker-login') {
                        sh "docker build -t bjrules/phptodo:$IMAGE_TAG ."
 
                    }
                  
                }
            }
        }


          stage('Push Image') {
            steps {
                script {

                    withDockerRegistry(credentialsId: 'docker-login') {
                        sh "docker push bjrules/phptodo:$IMAGE_TAG"
 
                    }
                  
                }
            }
        }
    }
    //      post {
    //     success {
    //         echo "PHP app Docker image pushed successfully: ${DOCKER_IMAGE}:${IMAGE_TAG}"
    //     }
    //     failure {
    //         echo "Build failed"
    //     }
    // }
    }

